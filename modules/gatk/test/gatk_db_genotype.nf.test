nextflow_process {

    name "Test Process GATK_JOINTGENOTYPING"
    script "../gatk_db_genotype.nf"
    process "GATK_JOINTGENOTYPING"

    test("Should call the trio joint genotype correctly") {

        when {
            params {
                outdir = "./results"
            }
            process {
                """
                input[0] = [
                    file("${projectDir}/modules/gatk/test/inputs/reads_father.bam.g.vcf"),
                    file("${projectDir}/modules/gatk/test/inputs/reads_mother.bam.g.vcf"),
                    file("${projectDir}/modules/gatk/test/inputs/reads_son.bam.g.vcf")
                ]
                
                input[1] = [
                    file("${projectDir}/modules/gatk/test/inputs/reads_father.bam.g.vcf.idx"),
                    file("${projectDir}/modules/gatk/test/inputs/reads_mother.bam.g.vcf.idx"),
                    file("${projectDir}/modules/gatk/test/inputs/reads_son.bam.g.vcf.idx")
                ]
                
                input[2] = file("${projectDir}/data/ref/intervals.bed")
                input[3] = "family_cohort"
                input[4] = file("${projectDir}/data/ref/ref.fasta")
                input[5] = file("${projectDir}/data/ref/ref.fasta.fai")
                input[6] = file("${projectDir}/data/ref/ref.dict")
                """
            }
        }

    then {
        assert process.success
        assert path(process.out[0][0]).readLines().any { it.contains('#CHROM') }
        assert path(process.out[0][0]).readLines().any { it.contains('AF=0.833') }
    }

    }

}
